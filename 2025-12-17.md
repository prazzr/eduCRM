# Integrated Education Consultancy CRM, LMS, & Accounting System
**Date:** 2025-12-19
**Version:** 1.2.0 (CRUD & UX Optimization)
**Status:** Alpha - Feature Complete (Full CRUD Support)

## 1. System Overview
 This system is a bespoke solution designed for an Educational Consultancy. It integrates three core pillars:
1.  **CRM (Customer Relationship Management)**: Manages student inquiries, lead conversion, and counseling workflows.
2.  **LMS (Learning Management System)**: Facilitates class setups, teacher assignments, material sharing, and student submissions.
3.  **Accounting**: Tracks fee types, invoices (student fees), and payment history with a ledger view.

### Key Value-Add Features
-   **Public Lead Capture**: Dedicated landing page (`public_enquiry.php`) for 24/7 lead generation.
-   **Visual Analytics**: Dashboard with real-time charts for inquiry statuses and conversion funnels.
-   **Student Profile 360**: Unified view including Communication Logs, Documents, and Financials.
-   **Consultancy Tools**:
    -   University Application Tracker (Kanban-style status tracking).
    -   Partner/Agent Database.
    -   Test Score Management (IELTS/PTE).
    -   Document Vault (Secure file storage).

---

## 2. Technical Architecture
-   **Backend**: Vanilla PHP 8.x (No frameworks, lightweight and fast).
-   **Database**: MySQL 8.x (Relational schema).
-   **Frontend**: HTML5, Vanilla CSS (`assets/css/style.css`), Chart.js (Analytics).
-   **Server**: Apache (via XAMPP).
-   **Authentication**: Session-based with Role-Based Access Control (RBAC).

---

## 3. Database Schema (`edu_crm`)

### User & Access Management (Multi-Role)
-   **users**: `id, name, email, password_hash, primary_role, phone, country, education_level, passport_number`
-   **roles**: `id, name` (admin, counselor, teacher, student, accountant)
-   **user_roles**: `user_id, role_id` (Link table supporting multiple roles per user)

### CRM & Counseling
-   **inquiries**: `id, name, email, phone, country, course, status, assigned_to`
-   **student_logs**: `id, student_id, author_id, type (call/note/email), message` *(Communication Timeline)*
-   **partners**: `id, name, type, country, website`
-   **visa_workflows**: `id, student_id, country, current_stage, notes` *(Enhanced Pipeline)*

### LMS (Learning)
-   **courses**: `id, name (e.g. IELTS), description`
-   **classes**: `id, course_id, teacher_id, name, schedule, start_date, status (active/closed)`
-   **enrollments**: `id, student_id, class_id, enrolled_at`
-   **daily_rosters**: `id, class_id, teacher_id, roster_date, topic` *(Daily Lesson Records)*
-   **daily_performance**: `id, roster_id, student_id, attendance (present/absent/late), class_task_mark, home_task_mark, remarks` *(Granular Tracking)*
-   **class_materials**: `id, class_id, teacher_id, title, file_path, type`
-   **submissions**: `id, material_id, student_id, file_path, grade, submitted_at, comments` *(Graded Task & Assignment Repository)*

### Accounting
-   **fee_types**: `id, name, default_amount`
-   **student_fees**: `id, student_id, fee_type_id, amount, status (unpaid/partial/paid)`
-   **payments**: `id, student_fee_id, amount, method, transaction_date`

### Consultancy Extensions
-   **university_applications**: `id, student_id, university_name, status (applied/offer/visa), notes`
-   **student_documents**: `id, student_id, title, file_path`
-   **test_scores**: `id, student_id, test_type, overall_score, breakdown`
-   **notifications**: `id, user_id, message, is_read`

---

## 4. Module Breakdown

### 4.1 Public Facing
-   **`public_enquiry.php`**: Standalone capture form. Submits data to `inquiries` table. No login required.

### 4.2 CRM Module (`modules/inquiries/`)
-   **Inquiry List**: View and filter leads.
-   **Conversion Logic**: One-click conversion with **Secure Password Generation** and automated field mapping (Country, Education).
-   **Student Profile (`modules/students/profile.php`)**:
    -   View Enrolled Classes.
    -   View/Add Communication Logs.
    -   Quick links to Ledger, Documents, and **Visa Workflow**.

### 4.3 LMS Module (`modules/lms/`)
- **Courses & Classes**: Admin defines courses; Teachers run classes.
- **Classroom (`classroom.php`)**:
    - **Stream**: Teachers post notices/readings/assignments and **Specialized Tasks** (Class Task/Home Task).
    - **Submissions**: Students upload answers (Photo/PDF); Teachers review and grade them.
- **Review & Sync (`review_submissions.php`)**:
    - Teachers grade online tasks and sync them directly to a specific **Physical Class Session**.
- **Daily Journal (`daily_roster.php`)**:
    - Integrated grading table where LMS marks automatically appear beside physical attendance logs.

### 4.4 Accounting Module (`modules/accounting/`)
-   **Fee Structure**: Define standard fees (Tuition, Visa Processing).
-   **Student Ledger**:
    -   Assign specific fees to students.
    -   Record partial payments.
    -   Auto-calculation of "Remaining Due".

### 4.5 Advanced Modules
-   **`modules/users/`**: Advanced staff and student management. Supports multi-role assignment and one-time password sharing.
-   **`modules/partners/`**: Database of universities and agents.
-   **`modules/applications/`**: Track university application status.
-   **`modules/visa/`**: Dedicated Visa Workflow Pipeline (Collection -> Submission -> Interview -> Approved).
-   **`modules/documents/`**: Secure upload/view of PDFs/Images.
-   **`modules/scores/`**: Track standardized test results.

---

## 5. File Structure
```
c:/xampp/htdocs/CRM/
├── assets/
│   ├── css/style.css       # Main stylesheet
├── includes/
│   ├── header.php          # Nav, Notifications, RBAC checks
│   ├── footer.php
│   ├── notifications.php   # Helper functions
├── modules/
│   ├── accounting/         # Ledger, Fees, Payments
│   ├── applications/       # University Tracker
│   ├── documents/          # Student Vault
│   ├── inquiries/          # CRM Lead Management
│   ├── lms/                # Classrooms, Courses
│   ├── partners/           # University Database
│   ├── scores/             # Test Score Tracking
│   ├── students/           # Full Profile & Logs
├── uploads/                # Secured storage for user files
├── config.php              # DB Connection & Base Config
├── index.php               # Dashboard (w/ Analytics)
├── login.php               # Auth
├── public_enquiry.php      # Public Landing Page
└── schema.sql              # Database Setup
```

## 6. Security Implementation
1.  **Input Sanitization**: All POST/GET data is sanitized via `htmlspecialchars` and `strip_tags`.
2.  **Prepared Statements**: PDO is used for all queries to prevent SQL Injection.
3.  **Password Hashing**: `password_hash()` (Bcrypt) used for user credentials.
4.  **RBAC**: `requireLogin()` and `hasRole()` functions enforce permission checks at the top of every restricted file.

## 7. Compliance with Technical Requirements (Reference: `Technical requirement.pdf`)

### 7.1 Integrated Features (Req 3.4)
-   **Dashboard**: Implemented role-specific dashboards with Visual Analytics (Chart.js) as requested.
-   **Notifications**: Implemented `notifications` table and UI alerts (Bell Icon).
-   **Document Management**: Implemented `student_documents` vault for visa/passport storage.

### 7.2 Study Abroad Features (Req 3.5)
-   **Visa Tracking**: Implemented via dedicated `visa_workflows` pipeline viewable on **Student Profile** and **Dashboard**.
-   **Test Score Integration**: Implemented `test_scores` module for IELTS/PTE/SAT on student profiles.
-   **Partner Management**: Implemented `partners` module for university/agent associations.
-   **Application Management**: Implemented Kanban-style Tracker for multiple university applications.

### 7.3 Advanced LMS & Hybrid Learning (Req 3.6 - Unified Grading)
-   **Hybrid Task Support**: Implemented `Class Task` and `Home Task` categories for online/hybrid flexibility.
-   **Multi-Format Submissions**: Support for Photo/PDF uploads for all task types.
-   **Centralized Gradebook**: Automated sync between LMS submissions and physical **Daily Roster** journals, ensuring a single source of truth for student performance.
-   **Student Transparency**: Grade results and teacher feedback visible directly on the **Student Dashboard** and **Class Stream**.

### 7.3 Non-Functional Requirements (Req 4.0)
-   **Performance**: Lightweight Vanilla PHP ensures <2s response time (meeting Req 4.1).
-   **Security** (Req 4.2):
    -   *Authentication*: Session-based (Secure stack).
    -   *Data Protection*: `password_verify` (Bcrypt) utilized.
    -   *Access Control*: Strict Role-Based Access Control (RBAC) on all modules.
-   **Usability** (Req 4.3):
    -   Responsive CSS (`assets/css/style.css`) for mobile compatibility.
    -   Dynamic Menus based on User Role.

### 7.4 Data Model Alignment (Req 5.1)
The implemented schema matches the high-level entity requirements:
-   **User/Student/Course/Class/Teacher**: Implemented in Core.
-   **Inquiry/Application/Visa**: Implemented in CRM & Consultancy extensions.
-   **Payment**: Implemented in Accounting.

## 8. Future Roadmap & Recommendations
1.  **Email Automation**: Integrate PHPMailer to send real welcome emails upon Inquiry submission.
2.  **Payment Gateway**: Integrate Stripe/PayPal for online fee payment in `student_ledger.php`.
3.  **PDF Receipt Generation**: Use `FPDF` or `TCPDF` to generate downloadable invoices.
4.  **AI Enhancements** (Req 8.0): Future integration of chatbot for public inquiries.
